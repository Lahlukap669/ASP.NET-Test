# ASP.NET-Test

This is a .NET 9.0 web API for managing Users, following the principles of Clean Architecture.

## Project Structure
- `src/Users.API`: The main API project. This is the entry point of the application.
- `src/Users.Application`: Contains the application logic. This layer is responsible for the application's behavior and policies.
- `src/Users.Domain`: Contains enterprise logic and types. This is the core layer of the application.
- `src/Users.Infrastructure`: Contains infrastructure-related code such as database and file system interactions. This layer supports the higher layers.
- We could also add all the test into new project `src/Users.API.Tests` (usually auto generated by VS) and test different scenarios like: Domain logic, Key application logic, Query/command logic, Mapping, Middlewares ...

## Packages and Libraries

This project uses several NuGet packages and libraries to achieve its functionality:

- **Serilog**: This library is used for logging. It provides a flexible and easy-to-use logging API.

- **MediatR**: This library is used to implement the Command Query Responsibility Segregation (CQRS) pattern. In this solution, commands (which change the state of the system) and queries (which read the state) are separated for clarity and ease of development.

- **Entity Framework**: This is an open-source ORM framework for .NET. It enables developers to work with data using objects of domain-specific classes without focusing on the underlying database tables and columns where this data is stored.

- **AutoMapper**: This is an object-to-object mapping library in .NET that simplifies the process of transforming one object type into another, typically used for mapping data transfer objects (DTOs) to domain models and vice versa. It reduces boilerplate code by automatically mapping properties with matching names and types.

- **SwashBuckle**: This is a library in .NET that integrates Swagger with ASP.NET Core applications, automatically generating interactive API documentation from your application's code and enabling features like testing endpoints directly from the documentation UI.

## Getting Started

### Prerequisites

- .NET 9.0
- Visual Studio 2022 or later

### Building

To build the project, open the `Users.sln` file in Visual Studio and build the solution.

### Running

To run the project, set `Users.API` as the startup project in Visual Studio and start the application.

# API Endpoints

## Endpoints Overview

| Method | Endpoint                          | Auth Required |
|--------|-----------------------------------|---------------|
| GET    | `/api/users`                      | Bearer token  |
| GET    | `/api/users/{id}`                 | Bearer token  |
| DELETE | `/api/users/{id}`                 | Bearer token  |
| POST   | `/api/users`                      | Bearer token  |
| PATCH  | `/api/users/{id}`                 | Bearer token  |
| POST   | `/api/users/validate-credentials` | Bearer token  |
| POST   | `/api/users/generate-api-key`     | Bearer token  |
| POST   | `/api/users/validate-api-key`     | Bearer token  |

---

## Endpoints detailed description

### 1. `GET /api/users`
- **Description**: Retrieves all users.
- **Parameters**: None
- **Headers**: 
  - `X-Api-Key` (string): API Key for authentication.
- **Response**: 
  - `200 OK`: Returns a list of users.
  - `401 Unauthorized`: API Key is missing or invalid.

---

### 2. `GET /api/users/{id}`
- **Description**: Retrieves a user by their ID.
- **Parameters**:
  - `id` (int): The ID of the user.
- **Headers**: 
  - `X-Api-Key` (string): API Key for authentication.
- **Response**: 
  - `200 OK`: Returns the user details.
  - `404 Not Found`: User with the given ID does not exist.
  - `401 Unauthorized`: API Key is missing or invalid.

---

### 3. `DELETE /api/users/{id}`
- **Description**: Deletes a user by their ID.
- **Parameters**:
  - `id` (int): The ID of the user.
- **Headers**: 
  - `X-Api-Key` (string): API Key for authentication.
- **Response**: 
  - `204 No Content`: Returns Empty content.
  - `404 Not Found`: User with the given ID does not exist.
  - `401 Unauthorized`: API Key is missing or invalid. 

---

### 4. `POST /api/users`
- **Description**: Creates a new user.
- **Parameters**: 
  - **Body**:
  ```json
  {
    "userName": "string",
    "fullName": "string",
    "email": "string",
    "mobile": "string",
    "language": "string",
    "culture": "string",
    "password": "string"
  }
  ```
- **Headers**: 
  - `X-Api-Key` (string): API Key for authentication.
- **Response**: 
  - `201 Created`: User is created successfully.
  - `400 Bad Request`: Validation errors.
  - `401 Unauthorized`: API Key is missing or invalid. 

---

### 5. `PATCH /api/users/{id}`
- **Description**: Updates user details.
- **Parameters**:
  - `id` (int): The ID of the user to be updated.
- **Headers**: 
  - `X-Api-Key` (string): API Key for authentication.
- **Body**:
```json
  {
    "fullName": "string",
    "email": "string",
    "mobile": "string",
    "language": "string",
    "culture": "string",
    "password": "string"
  }

```
- **Response**: 
  - `204 No Content`: Returns Empty content.
  - `404 Not Found`: User with the given ID does not exist.
  - `401 Unauthorized`: API Key is missing or invalid.

 ---

 ### 6. `POST /api/users/validate-credentials`
- **Description**: Validates user credentials.
- **Parameters**: 
  - **Body**:
  ```json
  {
    "email": "string",
    "password": "string"
  }
  ```
- **Headers**: 
  - `X-Api-Key` (string): API Key for authentication.
- **Response**: 
  - `200 OK`: Credentials are valid.
  - `400 Bad Request`: Validation errors.
  - `401 Unauthorized`: API Key is missing or invalid. 

---

 ### 7. `POST /api/users/generate-api-key`
- **Description**: Generates a new API key for a client.
- **Parameters**: 
  - **Body**:
  ```json
  {
    "clientName": "string"
  }
  ```
- **Headers**: 
  - `X-Api-Key` (string): API Key for authentication.
- **Response**: 
  - `201 Created`: Returns the newly generated API key.
  - `400 Bad Request`: Validation errors.
  - `401 Unauthorized`: API Key is missing or invalid.
 
---

 ### 8. `POST /api/users/validate-api-key`
- **Description**: Validates an API key.
- **Parameters**: 
  - **Body**:
  ```json
  {
    "key": "string"
  }
  ```
- **Headers**: 
  - `X-Api-Key` (string): API Key for authentication.
- **Response**: 
  - `200 OK`: API Key is valid.
  - `400 Bad Request`: Validation errors.
  - `401 Unauthorized`: API Key is missing or invalid.

---

## Docs

Docs are accessible via Root connection to the project under endpoint swagger (localhost:7250/swagger) as seen in the picture below. To get access, docs must first be authenticated with APIKey.

![alt text](https://github.com/Lahlukap669/ASP.NET-Test/blob/master/Swagger.png)

## Database
Database is created with EF (EntityFramework) from microsoft which in background uses SQL. It should already be set once project is cloned or forked (migration exists in files). If it breaks the recommended steps are:
- Navigate to Package Manager Console (StartUpProject:Users.API, DefaultProject:Users.Infrastructure)
- Remove current database if exists: `drop-database`
- Manually delete migration folder (and all migrations)
- Create new migration `add-migration name`
- Sync changes to Database `update-database`

We have seeder files that will populate empty tables User and ApiKey. Now how to get APIKey => Recommended use of azure data studio => connect to database with DbString in project's appSettings (dbname should be UsersDb) => make a costum query like `SELECT * FROM ApiKey`. Copy APIKey and you should be set. CURRENT APIKEY IS SET IN Users.API.Http !!!

## ApiKey
With at least 1 known ApiKey you can generate new ApiKeys, providing name of new client.

## Disclaimer
- Authentication and authorization would otherwise be implemented using Microsoft VS extensions such as ASP.NET Identity, but the instructions wanted APIKey and Not Client Login or MFA.

# Info
```C#
  string AUTHOR = "Luka Lah"; //https://github.com/Lahlukap669
```
